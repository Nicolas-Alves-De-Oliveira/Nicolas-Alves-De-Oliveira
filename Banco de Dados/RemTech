/* BANCO DE DADOS NO SQL SERVER */

CREATE DATABASE RemTech
GO

USE RemTech
GO

--TABELAS--

CREATE TABLE FUNCIONARIOS(
                         IDFUNCIONARIO INT PRIMARY KEY IDENTITY,
                         NOME VARCHAR(30) NOT NULL,
                         SEXO CHAR(1) NOT NULL
				 CHECK( SEXO IN('M','F')),
                         EMAIL VARCHAR(40) UNIQUE,
                         CPF CHAR(15) NOT NULL UNIQUE,
                         CARGO VARCHAR(30) NOT NULL,
                         SALARIO DECIMAL(10,2) NOT NULL,
 )
GO

CREATE TABLE ENDERECO(
                         IDENDERECO INT PRIMARY KEY IDENTITY(100,10),
                         RUA VARCHAR(40) NOT NULL,
                         BAIRRO VARCHAR(40) NOT NULL,
                         CIDADE VARCHAR(40) NOT NULL,
                         ESTADO CHAR(2) NOT NULL
            CHECK ( ESTADO IN('SP','RJ','MG','AC','AL','GO','PA','BA')),
                         ID_FUNCIONARIO INT UNIQUE
)
GO

CREATE TABLE TELEFONE(
                          IDTELEFONE INT PRIMARY KEY IDENTITY(1000,10),
                          TIPO CHAR(3) NOT NULL
             CHECK ( TIPO IN('RES','CEL','COM')),
                          NUMERO VARCHAR(20) NOT NULL,
                          ID_FUNCIONARIO INT
)
GO

--CHAVES E CONSTRAINTS--

ALTER TABLE ENDERECO
ADD CONSTRAINT FK_ENDERECO_FUNCIONARIOS
FOREIGN KEY( ID_FUNCIONARIO)
REFERENCES  FUNCIONARIOS(IDFUNCIONARIO)
GO

ALTER TABLE TELEFONE
ADD CONSTRAINT FK_TELEFONE_FUNCIONARIOS
FOREIGN KEY( ID_FUNCIONARIO)
REFERENCES  FUNCIONARIOS(IDFUNCIONARIO)
GO

--DADOS--

INSERT INTO FUNCIONARIOS VALUES('Jose','M',
'jose@gmail.com','147822145','Vendas',1440.88)
GO
INSERT INTO FUNCIONARIOS VALUES('Ana','F',
'Ana@gmail.com','87845451','Gerente de Vendas',2500.00)
GO
INSERT INTO FUNCIONARIOS VALUES('Lucas','M',
'Lucas@gmail.com','487486746','Porteiro',1250.00)
GO
INSERT INTO FUNCIONARIOS VALUES('Harry','M',
'Harry@gmail.com','455478775','Gestor de Logística',3000.00)
GO
INSERT INTO FUNCIONARIOS VALUES('Josefa','F',NULL,
'46854555','Faxineira',1300.00)
GO
INSERT INTO ENDERECO VALUES('Rua dos Anjos','Centro',
'São Paulo','SP',3)
GO
INSERT INTO ENDERECO VALUES('Rua Vinte','Centro',
'São Paulo','SP',1)
GO
INSERT INTO ENDERECO VALUES('Rua das Ruas','Minas',
'Minas Gerais','MG',2)
GO
INSERT INTO ENDERECO VALUES('Rua Polo sul','Goiana',
'Goiana','GO',5)
GO
INSERT INTO ENDERECO VALUES('Rua Pirata','Lapa',
'Rio de Janeiro','RJ',6)
GO
INSERT INTO TELEFONE VALUES('RES','59314087',5)
GO
INSERT INTO TELEFONE VALUES('CEL','945256565',3)
GO
INSERT INTO TELEFONE VALUES('CEL','948784512',1)
GO
INSERT INTO TELEFONE VALUES('COM','9999477441',2)
GO
INSERT INTO TELEFONE VALUES('CEL','974121528',6)
GO
INSERT INTO TELEFONE VALUES('CEL','978784444',2)
GO
INSERT INTO TELEFONE VALUES('COM','9997744415',1)
GO

-- PROJEÇÕES --

SELECT * FROM FUNCIONARIOS
SELECT * FROM TELEFONE
SELECT * FROM ENDERECO


--VIEW--

CREATE VIEW V_FUNCIONARIOS AS 
SELECT F.NOME,
             F.SEXO AS GÊNERO, 
             F.EMAIL, 
      ISNULL(F.CPF,'Não Possui') AS "E-Mail",
             F.CARGO,
             F.SALARIO, 
             E.RUA,
             E.BAIRRO,
             E.CIDADE, 
             E.ESTADO, 
             T.TIPO, 
             T.NUMERO
FROM FUNCIONARIOS F
INNER JOIN ENDERECO E
ON F.IDFUNCIONARIO = E.ID_FUNCIONARIO
INNER JOIN TELEFONE T
ON F.IDFUNCIONARIO = T.ID_FUNCIONARIO
GO

SELECT * FROM V_FUNCIONARIOS
GO

