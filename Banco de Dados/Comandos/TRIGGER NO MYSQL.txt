/* TRIGGER NO MYSQL */

CREATE DATABASE VENDAS;
USE VENDAS;

CREATE TABLE PRODUTOS(
          IDPRODUTO INT PRIMARY KEY AUTO_INCREMENT,
          PRODUTO VARCHAR(50) NOT NULL,
          CATEGORIA VARCHAR(30) NOT NULL,
          PRECO FLOAT(10,2) NOT NULL
);

CREATE TABLE HISTORICO_PRECO(
           IDOPERACAO INT PRIMARY KEY AUTO_INCREMENT,
           PRODUTO VARCHAR(50) NOT NULL,
           CATEGORIA VARCHAR(30) NOT NULL,
           PRECO_ANTIGO FLOAT(10,2)  NOT NULL,
           PRECO_NOVO FLOAT(10,2)  NOT NULL,
           DATA DATETIME,
           USUARIO VARCHAR(30),
           OBS VARCHAR(50)
);

INSERT INTO PRODUTOS VALUES('Pote de Geleia','Comida',13.00)
INSERT INTO PRODUTOS VALUES('A Mão Misteriosa','Livros',50.00)
INSERT INTO PRODUTOS VALUES('Carne de Boi 2kg','Açougue',42.00)
INSERT INTO PRODUTOS VALUES('Iphone X12','Tecnologia',4200.00)
INSERT INTO PRODUTOS VALUES('Abacaxi','Comida',11.00)
INSERT INTO PRODUTOS VALUES('Sofá','Móvel',1200.00)
INSERT INTO PRODUTOS VALUES('Cama BOX','Móvel',1500.00)
INSERT INTO PRODUTOS VALUES('Cesta Básica','Comida',72.00)

--TRIGGER DE ATUALIZAÇÃO SOMENTE DE PREÇO--

DELIMITER //

CREATE TRIGGER ATT_PRECO FOR UPDATE
ON PRODUTOS FOR EACH ROW
IF UPDATE(PRECO)
BEGIN
               INSERT INTO HISTORICO_PRECO VALUES
               (NULL, OLD.PRODUTO, OLD.CATEGORIA, OLD.PRECO_ANTIGO, NEW.PRECO_NOVO, 
                NOW(), CURRENT_USER(),'ATUALIZAÇÃO DE PREÇO')
END
//

DELIMITER ;
